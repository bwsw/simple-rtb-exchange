@startuml

title: Cache initialization

boundary CacheUpdater
control DAO
control CacheHelper
database DB

== System initialization ==

DAO -> CacheUpdater: attach(this)

== System working ==

[-> CacheUpdater: init
activate CacheUpdater

loop for all attached DAO
    CacheUpdater -> DAO: notify(CacheInitialization)
    activate DAO
    DAO -> DB: select
    DAO <-- DB: all not deleted entities
    DAO -> CacheHelper: updateCache(entities)
    activate CacheHelper

    CacheHelper -> CacheHelper: add all to cache
    activate CacheHelper
    deactivate CacheHelper

    DAO -> DAO: update tsversion
    activate DAO
    deactivate DAO
    deactivate DAO

end

deactivate CacheUpdater


@enduml
