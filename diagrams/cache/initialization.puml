@startuml

title: Cache initialization

boundary CacheUpdater
control DAO
control CacheHelper
database DB

== System initialization ==

DAO -> CacheUpdater: attach(this)
DAO <-- CacheUpdater

== System working ==

[--> CacheUpdater: init

activate CacheUpdater
    CacheUpdater -> DAO: notify(InitCache)
    activate DAO
        DAO -> DB: select
        DAO <-- DB: all not deleted entities
        DAO -> CacheHelper: updateCache(entities)
        activate CacheHelper
            CacheHelper -> CacheHelper: add all to cache
            CacheHelper -> CacheHelper: update tsversion
            CacheHelper --> DAO
        deactivate CacheHelper
        DAO --> CacheUpdater
    deactivate DAO
deactivate CacheUpdater

@enduml
